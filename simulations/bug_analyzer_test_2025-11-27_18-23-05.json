[
  {
    "scenario_id": "database_error",
    "scenario_name": "Database Integrity Error",
    "message": {
      "text": "IntegrityError when saving message to database. Foreign key constraint failed on channel_id. Stack trace shows error in cache_service.py line 45.",
      "channel_name": "engineering-alerts",
      "user_name": "AlertBot",
      "priority_score": 95
    },
    "timestamp": "2025-11-27T18:23:04.929792",
    "analysis": {
      "patterns": {
        "status_codes": [],
        "exception_types": [
          "IntegrityError"
        ],
        "file_mentions": [
          "cache_service.py"
        ],
        "class_mentions": [],
        "keywords": [
          "error",
          "failed"
        ]
      },
      "codebase_matches": [
        {
          "file": "backend/database/cache_service.py",
          "line": 1,
          "match_type": "file_reference",
          "snippet": "\"\"\"\nCache service for Slack messages and insights.\nHandles CRUD operations and deduplication.\n\"\"\"\n\nimport logging\nfrom sqlalchemy.orm import Session\nfrom typing import Optional, Dict, Any, List\nfrom datetime import datetime, timedelta\n\nfrom .models import SlackMessage, MessageInsight, SyncLog, UserP..."
        },
        {
          "file": "backend/services/code_bug_analyzer.py",
          "line": 30,
          "match_type": "grep_match",
          "term": "IntegrityError",
          "snippet": "r'\\b(IntegrityError|OperationalError|ProgrammingError)\\b',  # SQLAlchemy"
        },
        {
          "file": "backend/services/code_bug_analyzer.py",
          "line": 320,
          "match_type": "grep_match",
          "term": "IntegrityError",
          "snippet": "\"IntegrityError\": ["
        }
      ],
      "memory_matches": [
        {
          "issue": "Notion Block Format Errors",
          "context": "Syncing complex Slack messages with rich text to Notion caused validation errors.",
          "solution": "Created a Markdown-to-Notion block converter that sanitizes input. We strip unsupported formatting and truncate text blocks to 2000 characters.",
          "relevance": 0.5,
          "matched_terms": [
            "error"
          ]
        },
        {
          "issue": "Streamlit Widget KeyError on Dynamic Keys",
          "context": "Streamlit widgets without explicit `key` parameters can cause KeyError when the UI structure changes between reruns.",
          "solution": "Always provide explicit `key` attributes to `st.radio`, `st.selectbox`, `st.text_input` and other stateful widgets (e.g., `key='nav_radio'`) to prevent state conflicts.",
          "relevance": 0.5,
          "matched_terms": [
            "error"
          ]
        },
        {
          "issue": "Jira Description Must Be ADF",
          "context": "Jira API rejected plain text descriptions with error: 'Operation value must be an Atlassian Document'.",
          "solution": "Modified `jira_service.py` to convert all plain text descriptions to Atlassian Document Format (ADF) before sending to Jira API. ADF requires a specific JSON structure with type='doc', version=1, and content array.",
          "relevance": 0.3,
          "matched_terms": [
            "error"
          ]
        }
      ],
      "debugging_steps": [
        "Check database foreign key constraints",
        "Verify unique constraint violations",
        "Review code in cache_service.py for recent changes",
        "Past solution for 'Notion Block Format Errors': Created a Markdown-to-Notion block converter that sanitizes input. We strip unsupported formatting a...",
        "Past solution for 'Streamlit Widget KeyError on Dynamic Keys': Always provide explicit `key` attributes to `st.radio`, `st.selectbox`, `st.text_input` and other st...",
        "Start debugging from backend/database/cache_service.py"
      ],
      "summary": "Detected exceptions: IntegrityError | Related files: cache_service.py | Found references in: code_bug_analyzer.py, cache_service.py | Similar past issues: 3 found | Most relevant: 'Notion Block Format Errors'"
    },
    "success": true
  },
  {
    "scenario_id": "rate_limit",
    "scenario_name": "Slack API Rate Limit",
    "message": {
      "text": "Slack API returning 429 errors. Ingestion worker crashed. We're not handling the Retry-After header properly.",
      "channel_name": "incidents",
      "user_name": "PagerDuty",
      "priority_score": 98
    },
    "timestamp": "2025-11-27T18:23:04.963389",
    "analysis": {
      "patterns": {
        "status_codes": [
          "429"
        ],
        "exception_types": [],
        "file_mentions": [],
        "class_mentions": [],
        "keywords": [
          "error",
          "crash"
        ]
      },
      "codebase_matches": [],
      "memory_matches": [
        {
          "issue": "Notion Block Format Errors",
          "context": "Syncing complex Slack messages with rich text to Notion caused validation errors.",
          "solution": "Created a Markdown-to-Notion block converter that sanitizes input. We strip unsupported formatting and truncate text blocks to 2000 characters.",
          "relevance": 0.5,
          "matched_terms": [
            "error"
          ]
        },
        {
          "issue": "Streamlit Widget KeyError on Dynamic Keys",
          "context": "Streamlit widgets without explicit `key` parameters can cause KeyError when the UI structure changes between reruns.",
          "solution": "Always provide explicit `key` attributes to `st.radio`, `st.selectbox`, `st.text_input` and other stateful widgets (e.g., `key='nav_radio'`) to prevent state conflicts.",
          "relevance": 0.5,
          "matched_terms": [
            "error"
          ]
        },
        {
          "issue": "Slack API Rate Limiting (429)",
          "context": "We process thousands of messages per minute during ingestion bursts.",
          "solution": "Implemented exponential backoff using the `tenacity` library. We specifically handle the `Retry-After` header from Slack's API responses.",
          "relevance": 0.42403100775193797,
          "matched_terms": [
            "429"
          ]
        }
      ],
      "debugging_steps": [
        "Implement exponential backoff for API calls",
        "Check for Retry-After header and honor it",
        "Past solution for 'Notion Block Format Errors': Created a Markdown-to-Notion block converter that sanitizes input. We strip unsupported formatting a...",
        "Past solution for 'Streamlit Widget KeyError on Dynamic Keys': Always provide explicit `key` attributes to `st.radio`, `st.selectbox`, `st.text_input` and other st..."
      ],
      "summary": "HTTP errors: 429 | Similar past issues: 3 found | Most relevant: 'Notion Block Format Errors'"
    },
    "success": true
  },
  {
    "scenario_id": "notion_sync",
    "scenario_name": "Notion Sync Failure",
    "message": {
      "text": "Notion pages showing raw JSON instead of formatted text. The rich text blocks in notion_service.py aren't converting properly. ValidationError on nested blocks.",
      "channel_name": "product-feedback",
      "user_name": "Sarah",
      "priority_score": 85
    },
    "timestamp": "2025-11-27T18:23:04.965911",
    "analysis": {
      "patterns": {
        "status_codes": [],
        "exception_types": [
          "ValidationError"
        ],
        "file_mentions": [
          "notion_service.py"
        ],
        "class_mentions": [],
        "keywords": [
          "error"
        ]
      },
      "codebase_matches": [
        {
          "file": "backend/integrations/notion_service.py",
          "line": 1,
          "match_type": "file_reference",
          "snippet": "\"\"\"\nNotion integration service for creating tasks from Slack messages.\n\"\"\"\n\nimport asyncio\nimport logging\nfrom typing import Optional, List, Dict, Any\nimport httpx\nfrom datetime import datetime\n\nlogger = logging.getLogger(__name__)\n\n\nclass NotionTaskExtractor:\n    \"\"\"Extract actionable tasks from me..."
        },
        {
          "file": "backend/services/code_bug_analyzer.py",
          "line": 31,
          "match_type": "grep_match",
          "term": "ValidationError",
          "snippet": "r'\\b(ValidationError|HTTPException|RequestValidationError)\\b',  # FastAPI/Pydantic"
        },
        {
          "file": "backend/services/code_bug_analyzer.py",
          "line": 340,
          "match_type": "grep_match",
          "term": "ValidationError",
          "snippet": "\"ValidationError\": ["
        }
      ],
      "memory_matches": [
        {
          "issue": "Notion Block Format Errors",
          "context": "Syncing complex Slack messages with rich text to Notion caused validation errors.",
          "solution": "Created a Markdown-to-Notion block converter that sanitizes input. We strip unsupported formatting and truncate text blocks to 2000 characters.",
          "relevance": 0.5,
          "matched_terms": [
            "error"
          ]
        },
        {
          "issue": "Streamlit Widget KeyError on Dynamic Keys",
          "context": "Streamlit widgets without explicit `key` parameters can cause KeyError when the UI structure changes between reruns.",
          "solution": "Always provide explicit `key` attributes to `st.radio`, `st.selectbox`, `st.text_input` and other stateful widgets (e.g., `key='nav_radio'`) to prevent state conflicts.",
          "relevance": 0.5,
          "matched_terms": [
            "error"
          ]
        },
        {
          "issue": "Jira Description Must Be ADF",
          "context": "Jira API rejected plain text descriptions with error: 'Operation value must be an Atlassian Document'.",
          "solution": "Modified `jira_service.py` to convert all plain text descriptions to Atlassian Document Format (ADF) before sending to Jira API. ADF requires a specific JSON structure with type='doc', version=1, and content array.",
          "relevance": 0.3,
          "matched_terms": [
            "error"
          ]
        }
      ],
      "debugging_steps": [
        "Review Pydantic model field definitions",
        "Check input data format and types",
        "Review code in notion_service.py for recent changes",
        "Past solution for 'Notion Block Format Errors': Created a Markdown-to-Notion block converter that sanitizes input. We strip unsupported formatting a...",
        "Past solution for 'Streamlit Widget KeyError on Dynamic Keys': Always provide explicit `key` attributes to `st.radio`, `st.selectbox`, `st.text_input` and other st...",
        "Start debugging from backend/integrations/notion_service.py"
      ],
      "summary": "Detected exceptions: ValidationError | Related files: notion_service.py | Found references in: code_bug_analyzer.py, notion_service.py | Similar past issues: 3 found | Most relevant: 'Notion Block Format Errors'"
    },
    "success": true
  },
  {
    "scenario_id": "api_500",
    "scenario_name": "API 500 Error",
    "message": {
      "text": "500 Internal Server Error on /api/slack/sync endpoint. Started after the latest deploy. TypeError in routes.py - 'NoneType' has no attribute 'get'",
      "channel_name": "engineering-alerts",
      "user_name": "Marcus",
      "priority_score": 92
    },
    "timestamp": "2025-11-27T18:23:04.982265",
    "analysis": {
      "patterns": {
        "status_codes": [
          "500"
        ],
        "exception_types": [
          "TypeError"
        ],
        "file_mentions": [
          "routes.py"
        ],
        "class_mentions": [],
        "keywords": [
          "error"
        ]
      },
      "codebase_matches": [
        {
          "file": "backend/api/routes.py",
          "line": 1,
          "match_type": "file_reference",
          "snippet": "\"\"\"\nFastAPI routes for Slack Intelligence API.\n\"\"\"\n\nfrom fastapi import APIRouter, HTTPException, Query\nfrom typing import List, Optional\n\nfrom .schemas import (\n    SmartInboxResponse,\n    MessageDetail,\n    SyncResponse,\n    SearchResponse,\n    StatsResponse\n)\nfrom ..services.inbox_service import ..."
        },
        {
          "file": "backend/ingestion/message_parser.py",
          "line": 61,
          "match_type": "grep_match",
          "term": "TypeError",
          "snippet": "try:"
        },
        {
          "file": "backend/ingestion/message_parser.py",
          "line": 63,
          "match_type": "grep_match",
          "term": "TypeError",
          "snippet": "except (ValueError, TypeError):"
        },
        {
          "file": "backend/services/code_bug_analyzer.py",
          "line": 29,
          "match_type": "grep_match",
          "term": "TypeError",
          "snippet": "r'\\b(TypeError|ValueError|KeyError|AttributeError|IndexError)\\b',"
        }
      ],
      "memory_matches": [
        {
          "issue": "Notion Block Format Errors",
          "context": "Syncing complex Slack messages with rich text to Notion caused validation errors.",
          "solution": "Created a Markdown-to-Notion block converter that sanitizes input. We strip unsupported formatting and truncate text blocks to 2000 characters.",
          "relevance": 0.5,
          "matched_terms": [
            "error"
          ]
        },
        {
          "issue": "Streamlit Widget KeyError on Dynamic Keys",
          "context": "Streamlit widgets without explicit `key` parameters can cause KeyError when the UI structure changes between reruns.",
          "solution": "Always provide explicit `key` attributes to `st.radio`, `st.selectbox`, `st.text_input` and other stateful widgets (e.g., `key='nav_radio'`) to prevent state conflicts.",
          "relevance": 0.5,
          "matched_terms": [
            "error"
          ]
        },
        {
          "issue": "Jira Description Must Be ADF",
          "context": "Jira API rejected plain text descriptions with error: 'Operation value must be an Atlassian Document'.",
          "solution": "Modified `jira_service.py` to convert all plain text descriptions to Atlassian Document Format (ADF) before sending to Jira API. ADF requires a specific JSON structure with type='doc', version=1, and content array.",
          "relevance": 0.3,
          "matched_terms": [
            "error"
          ]
        }
      ],
      "debugging_steps": [
        "Check function parameter types",
        "Verify None values are handled",
        "Check server logs for stack traces",
        "Verify database connectivity",
        "Review code in routes.py for recent changes",
        "Past solution for 'Notion Block Format Errors': Created a Markdown-to-Notion block converter that sanitizes input. We strip unsupported formatting a...",
        "Past solution for 'Streamlit Widget KeyError on Dynamic Keys': Always provide explicit `key` attributes to `st.radio`, `st.selectbox`, `st.text_input` and other st...",
        "Start debugging from backend/api/routes.py"
      ],
      "summary": "Detected exceptions: TypeError | HTTP errors: 500 | Related files: routes.py | Found references in: message_parser.py, routes.py | Similar past issues: 3 found | Most relevant: 'Notion Block Format Errors'"
    },
    "success": true
  },
  {
    "scenario_id": "jira_adf",
    "scenario_name": "Jira Description Error",
    "message": {
      "text": "Jira API rejecting ticket creation with error: 'Operation value must be an Atlassian Document'. Plain text descriptions not working in jira_service.py",
      "channel_name": "engineering",
      "user_name": "Kyle",
      "priority_score": 80
    },
    "timestamp": "2025-11-27T18:23:05.001390",
    "analysis": {
      "patterns": {
        "status_codes": [],
        "exception_types": [],
        "file_mentions": [
          "jira_service.py"
        ],
        "class_mentions": [],
        "keywords": [
          "error",
          "not working"
        ]
      },
      "codebase_matches": [
        {
          "file": "backend/integrations/jira_service.py",
          "line": 1,
          "match_type": "file_reference",
          "snippet": "\"\"\"\nJira integration service for creating tickets from Slack messages.\n\"\"\"\n\nimport logging\nfrom typing import Dict, Any, Optional, List\nimport httpx\nfrom slack_sdk.web.async_client import AsyncWebClient\n\nfrom ..config import settings\n\nlogger = logging.getLogger(__name__)\n\n\nclass JiraService:\n    \"\"\"..."
        }
      ],
      "memory_matches": [
        {
          "issue": "Notion Block Format Errors",
          "context": "Syncing complex Slack messages with rich text to Notion caused validation errors.",
          "solution": "Created a Markdown-to-Notion block converter that sanitizes input. We strip unsupported formatting and truncate text blocks to 2000 characters.",
          "relevance": 0.5,
          "matched_terms": [
            "error"
          ]
        },
        {
          "issue": "Streamlit Widget KeyError on Dynamic Keys",
          "context": "Streamlit widgets without explicit `key` parameters can cause KeyError when the UI structure changes between reruns.",
          "solution": "Always provide explicit `key` attributes to `st.radio`, `st.selectbox`, `st.text_input` and other stateful widgets (e.g., `key='nav_radio'`) to prevent state conflicts.",
          "relevance": 0.5,
          "matched_terms": [
            "error"
          ]
        },
        {
          "issue": "Jira Description Must Be ADF",
          "context": "Jira API rejected plain text descriptions with error: 'Operation value must be an Atlassian Document'.",
          "solution": "Modified `jira_service.py` to convert all plain text descriptions to Atlassian Document Format (ADF) before sending to Jira API. ADF requires a specific JSON structure with type='doc', version=1, and content array.",
          "relevance": 0.44375,
          "matched_terms": [
            "error"
          ]
        }
      ],
      "debugging_steps": [
        "Review code in jira_service.py for recent changes",
        "Past solution for 'Notion Block Format Errors': Created a Markdown-to-Notion block converter that sanitizes input. We strip unsupported formatting a...",
        "Past solution for 'Streamlit Widget KeyError on Dynamic Keys': Always provide explicit `key` attributes to `st.radio`, `st.selectbox`, `st.text_input` and other st...",
        "Start debugging from backend/integrations/jira_service.py"
      ],
      "summary": "Related files: jira_service.py | Found references in: jira_service.py | Similar past issues: 3 found | Most relevant: 'Notion Block Format Errors'"
    },
    "success": true
  }
]